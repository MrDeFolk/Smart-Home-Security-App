Проєкт: Smart Home Security Control Panel

Автор: MrDeFolk

Опис:
В рамках виконання магістерської кваліфікаційної роботи була реалізована (розділ 3 - Практичний розділ в роботі) програма яка є демонстраційною платформою. 
Вона моделює функції керування розумним будинком та демонструє впровадження методів програмного захисту обраних як найкраших в аналітичному розділі для: шифрування, автентифікації та захищеної передачі даних.

Програма моделює функції керування розумним будинком (перемикання ламп, встановлення температури термостата) та демонструє впровадження методів захисту інформації, таких як:
- Автентифікація користувача (Логін/пароль + TOTP).
- Хешування паролів за допомогою Argon2id.
- Захищене зберігання конфігурації (секрету TOTP) за допомогою Windows DPAPI.
- Взаємодія з MQTT-брокером через захищений канал TLS з автентифікацією за сертифікатами.
- Гібридне шифрування повідомлень (AES-256 + RSA-2048) для команд та статусів.
- Логування подій безпеки у локальну базу даних SQLite.
- Відображення статистики продуктивності криптографічних операцій.

Примітка: Програма хоч і розроблена для демонстрації та тестування алгоритмів безпеки тому попередньо не призначена для керування реальними фізичними пристроями але в разі необхідності може слугувати базою для реалізації відповідного фунціоналу.

Технології:
- Мова програмування: C#
- Платформа: .NET 8
- Інтерфейс: Windows Forms
- База даних: SQLite
- Криптографія: Argon2id (Konscious.Security.Cryptography), AES, RSA (.NET Cryptography), TOTP (Otp.NET), Base32 (Albireo.Base32), DPAPI (ProtectedData).
- Мережева взаємодія: MQTT (MQTTnet) через TLS.

Вимоги до середовища:
- Visual Studio 2022 (або новіше) з встановленим робочим навантаженням ".NET desktop development".
- .NET 8 SDK (зазвичай встановлюється разом з Visual Studio).
- MQTT Брокер: Рекомендовано Mosquitto (версія 2.x). https://mosquitto.org/download/
- OpenSSL: Необхідний для генерації сертифікатів. Найпростіше використовувати той, що йде в комплекті з Git for Windows (Git Bash). https://git-scm.com/download/win

Налаштування проєкту:
1. Отримайте код: Склонуйте репозиторій або розпакуйте архів з проєктом.
2. Відкрийте проєкт: Запустіть файл .sln у Visual Studio 2022.
3. Відновіть NuGet пакети: Visual Studio зазвичай робить це автоматично при першому відкритті або збиранні проєкту. Якщо ні, клацніть правою кнопкою миші на рішенні (Solution) у Solution Explorer -> Restore NuGet Packages.
4. Згенеруйте сертифікати:
- Виконайте кроки з інструкції tls_setup_guide_updated.md (або аналогічної, наданої раніше) для створення файлів ca.crt, server.crt, server.key, client.crt, client.key.
- Важливо: Скопіюйте файли ca.crt, server.crt, server.key у директорію встановлення Mosquitto (зазвичай C:\Program Files\mosquitto).
- Важливо: Створіть папку certs у корені вашого C# проєкту та скопіюйте туди файл ca.crt.
5. Згенеруйте RSA ключі:
- Виконайте кроки з інструкції rsa_key_generation_guide.md (або аналогічної) для створення файлів device_private.pem та device_public.pem.
- Важливо: Помістіть ці два файли у папку certs вашого C# проєкту. Переконайтесь, що у властивостях цих файлів у Visual Studio Copy to Output Directory встановлено на Copy if newer або Copy always.
6. Імпортуйте клієнтський сертифікат у Windows:
- Виконайте кроки з інструкції cert_store_import_guide.md (або аналогічної) для імпорту сертифіката client.pfx (створеного на кроці 4) у сховище сертифікатів поточного користувача (certmgr.msc -> Personal -> Certificates).
- Важливо: Скопіюйте Thumbprint (відбиток) імпортованого сертифіката.
7. Вставте Thumbprint у код:
- Відкрийте файл MqttService.cs у Visual Studio.
- Знайдіть рядок const string clientCertificateThumbprint = "..."; (приблизно рядок 77).
- Вставте скопійований Thumbprint замість "ВСТАВТЕ_ВАШ_THUMBPRINT_СЮДИ", видаливши пробіли.
8. Налаштуйте Mosquitto:
- Переконайтесь, що ваш файл mosquitto.conf (у C:\Program Files\mosquitto) містить коректні шляхи до сертифікатів (cafile, certfile, keyfile), налаштування listener 8883, require_certificate true, use_identity_as_username true та acl_file.
- Переконайтесь, що файл acl.conf (у тій самій папці) містить правила доступу для користувача smart-home-client.

Запуск програми
Важливо: MQTT брокер (Mosquitto) повинен бути запущений перед запуском C# програми.
1. Запустіть Mosquitto (рекомендовано в режимі відладки):
- Відкрийте Командний рядок (cmd) від імені адміністратора.
- Перейдіть до папки Mosquitto: cd "C:\Program Files\mosquitto"
- Запустіть брокер: mosquitto.exe -c mosquitto.conf -v
- Не закривайте це вікно командного рядка, воно буде показувати логи.
2. Запустіть C# програму:
- У Visual Studio натисніть F5 або кнопку Start.
3. Авторизація:
- При першому запуску буде створено базу даних smarthome_security.db та користувача за замовчуванням.
- Логін: admin
- Пароль: password
- Після введення пароля з'явиться екран 2FA. У вікні Output Visual Studio (канал Debug) або у спливаючому вікні MessageBox буде показано 6-значний код для тестування. Введіть його.

Після успішної авторизації ви повинні побачити панель керування, а в статус-барі - повідомлення "Підключено до MQTT брокера (TLS)".

Перший запуск та TOTP
- При першому запуску сервіс MfaService генерує унікальний секретний ключ TOTP для користувача admin і зберігає його у зашифрованому вигляді у файлі config.dat (поруч з .exe) за допомогою DPAPI.
- Важливо: Якщо ви видалите файл config.dat або запустите програму під іншим користувачем Windows, буде згенеровано новий секретний ключ, і коди зі старого автентикатора (якщо ви його налаштовували) перестануть працювати.

Структура проєкту (основні файли .cs)
- MainForm.cs / MainForm.Designer.cs: Головне вікно програми та його дизайн.
- Program.cs: Точка входу програми.
- DatabaseService.cs: Робота з базою даних SQLite.
- SecurityService.cs: Хешування та перевірка паролів (Argon2).
- ConfigurationService.cs: Безпечне зберігання налаштувань (DPAPI).
- MfaService.cs: Генерація та перевірка TOTP кодів.
- CryptographyService.cs: Реалізація AES, RSA та гібридного шифрування.
- MqttService.cs: Взаємодія з MQTT брокером (підключення, публікація, підписка).
- User.cs, Room.cs, Device.cs, SecurityLog.cs: Класи-моделі даних.